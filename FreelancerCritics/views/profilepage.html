<!DOCTYPE html>
<html>
  <head>
    <!-- Title, Specifications, and Imports -->
    <title>Profile Page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>
  <body>
    <!-- Navigation bar -->
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <!-- Auto collapse button when the page is too small -->
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>                        
          </button>
          <!-- Home page brand -->
          <a class="navbar-brand" href="/">FreelancerCritics</a>
        </div>
        <div class="collapse navbar-collapse">
          <!-- Logout : Redirects to loginpage-->
          <ul class="nav navbar-nav navbar-right">
            <li><a href="loginpage.html" onclick="logout()"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
            <script>
              function logout() {
                document.cookie.split(";").forEach(function(c) { 
                  document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
              }
            </script>
          </ul>
        </div>
      </div>
    </nav>
	<h3>
   
  <script>

    // Handles user sessions
    var userSession = require('./usersession.js');
    var username = document.cookie;

    // Handles db operations
    var DB = require('./DBClass.js');
    // Make the new class
    var con = new DB();
    // create database connection
      con.OpenConnection(function(err) {
        if(err) throw err;
        console.log("connected!");
      });
      con.Query("USE app_db;", function (err, result) {
        if (err) throw err;
        console.log("using app_db");
      });


      con.PrepQuery("SELECT name, profileContent, phone, education, skills FROM User,Profile WHERE username = ? AND Profile.ID = User.ID", [username], function (err, result) {
        // check for errors
        console.log("THIS IS SARAH SPECIFIC");
        if(err) throw err;  // throw error when necessary

        if (result == undefined) {
          console.log("Query is not working");
          res.Redirects('/');
        }

        // row not found case
        if(result.length == 0) {
          console.log("username not found");
          console.log("redirecting to profilepage.html");
        res.redirect('profilepage.html');
          return;
        }
        
        console.log("username found");
        var names = result[0].name;
        var profileC = result[0].profileContent;
      var phone = result[0].phone;
        var education = result[0].education;
        var skills = result[0].skills;
        console.log("skills: " + skills);
        
      console.log("Finished running");
    });
    
    //con.CloseConnection(function(err) {
      //if (err) throw err;
      //console.log("successfully closed");
      document.write("hwllo peos");
      document.write(profileC);
    //});
  </script> 

  </h3>

    <!--Profile edit button -->
    <div class="container">
  	<a href="edit.html" class="btn btn-info" role="button">Edit</a>
    </div>
  </body>
</html>
